<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://anrodon.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://anrodon.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-09-03T13:26:58+00:00</updated><id>https://anrodon.github.io/feed.xml</id><title type="html">blank</title><subtitle>Innovation, Finance, Digital Business &amp; Cars📍Barcelona </subtitle><entry><title type="html">Predicting road accidents in Spain using Open Data</title><link href="https://anrodon.github.io/blog/2025/predicting-road-accidents-in-spain-using-open-data/" rel="alternate" type="text/html" title="Predicting road accidents in Spain using Open Data"/><published>2025-05-19T14:54:20+00:00</published><updated>2025-05-19T14:54:20+00:00</updated><id>https://anrodon.github.io/blog/2025/predicting-road-accidents-in-spain-using-open-data</id><content type="html" xml:base="https://anrodon.github.io/blog/2025/predicting-road-accidents-in-spain-using-open-data/"><![CDATA[<p>In Spain, road accidents remain a significant public safety concern, leading to loss of lives (<strong>1.154 people lost their live on inter-urban roads in 2024</strong>)(font: <a href="https://elpais.com/espana/2025-01-10/1154-personas-murieron-en-las-carreteras-en-2024-14-mas-que-el-ano-anterior.html">El País</a>), injuries (<strong>4.634 hospital admissions in 2024</strong>)(font: <a href="https://elpais.com/espana/2025-01-10/1154-personas-murieron-en-las-carreteras-en-2024-14-mas-que-el-ano-anterior.html">El País</a>), and economic burdens. <strong>Despite various measures, predicting and preventing these incidents remains a challenge.</strong></p> <p>This article summarizes a small project I made which aims to leverage the power of <strong>machine learning to identify high-risk scenarios and suggest preventive measures</strong>.</p> <p>The aim of the project was to build a model that can <strong>predict if a road accident will have mortal victims or not</strong>, to be able to find which are the <strong>most relevant factors that lead to fatalities on the road</strong>.</p> <p>The metrics that I used to evolve the model have been accuracy and recall on the positive values for fatal accidents. I made this because it was crucial for me in this analysis to clearly detect the fatal accidents and was not that important if we had some false positives. <strong>At the end of the day, any recommendation we can give to avoid any accident will work on the right direction to safer roads.</strong></p> <p>With the identification of these factors I obtained conclusions that may help to provide measures that can prevent losses of lives.</p> <p>The data used for this project is the <a href="https://www.dgt.es/menusecundario/dgt-en-cifras/dgt-en-cifras-resultados/dgt-en-cifras-detalle/Ficheros-microdatos-de-accidentes-con-victimas-2023/">Ficheros microdatos de accidentes con víctimas 2023 dataset</a> by the Spanish General Traffic Administration (DGT — Dirección General de Tráfico). In the dataset webpage there is an excel file with the data and another one with the diccionary of the category identifiers.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/474/0*BltpNtV9R5gQgi8n"/></figure> <p>At the start of the project I took a look into the data and draw some plots that would help me understand better the dataset and obtain some draft hypothesis to work on.</p> <p>The first thing I saw is that the datset was clearly imbalanced. This was due to the fact that (luckily) most of the accidents don’t have fatal victims. <strong>In our dataset, more than 98% of the accidents didn’t have fatal victims. </strong>This fact would be a problem in order to create our model, so I created a new balanced version of the dataset selecting randomly non-fatal accidents until I had 50% of fatal and non-fatal accidents.</p> <p>With the plots previously drawn I was able to see some other interesting facts:</p> <ul><li>Spain has a <strong>much higher fatality rate in the weekends and in holiday seasons</strong> (summer months + november and december).</li></ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/584/1*5-Iqr3rr495uXl93auB1WA.png"/><figcaption>Proportion of Fatal and Non-Fatal accidents per day of the week</figcaption></figure> <figure><img alt="" src="https://cdn-images-1.medium.com/max/576/1*SyCXU6wbMmRzNbiaZdJshg.png"/><figcaption>Proportion of Fatal and Non-Fatal accidents per month</figcaption></figure> <ul><li><strong>Fatal accidents use to happen in interurban roads</strong>. We can see it not only in the ZONA_AGRUPADA category (the one that indicates 1 if the road where the accident happen is inter-urban and 2 if it is urban) but also in the ZONA (showing a big proportion of fatal accidents in inter-urban roads and an inverse proportion in streets) or the COD_PROVINCIA (shows a bigger proportion of non-fatal accidents in provinces like Madrid or Barcelona which most of its population lives in big cities).</li></ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/567/1*sATyTg9hfbuC9bl9Z4XwiQ.png"/><figcaption>1 means inter-urban roads and 2 urban roads</figcaption></figure> <figure><img alt="" src="https://cdn-images-1.medium.com/max/567/1*SVm2nxgD4UJP6Me_s_LjAw.png"/><figcaption>1 means inter-urban road, 2 means inter-urban road inside town, 3 means street, 4 urban motorway</figcaption></figure> <figure><img alt="" src="https://cdn-images-1.medium.com/max/812/1*sqOzCZqPeuq6y7bGEC8DBA.png"/><figcaption>Most populated areas show less percentage of fatal accidents</figcaption></figure> <ul><li><strong>Almost half of the mortal accidents happen in single-lane conventional roads</strong>. The other half is mostly happening in urban roads and expressways.</li></ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/567/1*mCquFecdlxlXTNG0OwbLGw.png"/><figcaption>1 and 2 mean toll and toll-free highways, 3 means motorway, 6 means single-lane conventional road, 9 means street</figcaption></figure> <ul><li><strong>Most fatal accidents are frontal collisions followed by run-off-road collisions and pedestrian hits.</strong></li></ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/576/1*czXcw1V4LMaJjlKo7C2zDA.png"/><figcaption>1=frontal, 2=fronto-lateral, 3=lateral, 4=rear-end, 7=pedestrian hits, 10=falls, 12&amp;16=run-off-road with collision</figcaption></figure> <ul><li><strong>Most fatal accident victims are car &amp; motorbike drivers/passengers &amp; pedestrians. </strong>This demonstrates the obvious fact that public transportation is a safer alternative of transportation</li></ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/571/1*gxmC11-wjCpaXOGdwybmEw.png"/></figure> <ul><li><strong>There are more fatal accidents happening in the night, specially at 3AM.</strong></li></ul> <figure><img alt="" src="https://cdn-images-1.medium.com/max/989/1*0HrmL2KipmAx1CJj55JdEw.png"/></figure> <p>These first facts already give hints about where to look deeper to increase security on the spanish roads.</p> <p>After this analysis, I started investigating which models would work better to classify if one accident will have or not fatal victims.</p> <p>After reading <a href="https://www.google.com/url?q=https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fabs%2Fpii%2FS0926580519305151">Machine learning predictive model based on national data for fatal accidents of construction workers</a> by Jongko Choi, Bonsung Gu, Sangyoon Chin, Jong-Seok Lee, I decided to proceed with a model based on a <strong>Random Forest Classifier as it was predictive model that performed the best when classifying workers who might face a fatality risk.</strong></p> <p>In addition to this, the <strong>Pandas Random Forest Classifier provides built-in feature importance scores</strong>. These <strong>scores indicate how much each feature contributes to the model’s predictions</strong>. This helped to identify which are the factors that contribute the most to fatality in road accidents.</p> <p>Before starting with the model, I eliminated from the dataset all columns that indicated number of fatalities as they would clearly influence my analisis to much.</p> <p>After that, to be able to use the Random Forest Classifier I needed all the variables in my dataset to be numerical, so I converted all the non-numerical columns to numerical and imputed the NaNs. I created a pipeline for that and then created train and test inputs to fit the model.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/462/1*dBqt0U5Hzk5DKbnZq_A6xw.png"/></figure> <p>This first version of the model showed to perform really good, with an accuracy of 86%.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/926/1*Bh4k7t_iVEgNGhCVxnZGQQ.png"/></figure> <p>I decided to see which were the features that had more importance in order to find useful conclusions and I saw that the most important features were the number of injured people in the accident.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*2fRgL8BVIuzdNs2iS1zNjw.png"/></figure> <p><strong>Surprisingly, the 2 features indicating the number of minor injured victims showed much higher importance than the major injured.</strong></p> <p>As this conclusions were not enough for me, I decided to eliminate from the original dataset the columns that had information about the injured victims and fit the model again.</p> <p>As expected the accuracy of the model was much lower (75%), so I decided to improve the model by trying a couple of things:</p> <ol><li>Add engineered features</li><li>Doing RandomSearch to look for better parameters that should help obtain better accuracy</li></ol> <p>I tried to add the following engineered features:</p> <ol><li>Weekend: 1 if weekend else 0</li><li>Night: 1 if hour between 0 and 8 and between 21 and 24 else 0</li><li>inStreet: 1 if accident happened in a street else 0</li></ol> <p>After doing so, I<strong> fitted the model again without satisfactory results so I decided to remove the new features</strong>.</p> <p>Then, proceeded to do the <strong>RandomSearch which provided great improvements in our target metric</strong> (recall) (<strong>up to 87% for predicting actual fatal accidents</strong>). The number of <strong>false positives also incremented</strong> but is nothing to worry about as the <strong>worst that could happen is that we recommend measures to reduce mortality in accidents that are already not mortal</strong>.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/890/1*X5BIincd9CtF-Lt-E0fvcA.png"/></figure> <p>Being happy with the model, I started analysing the importance of the features in predicting fatal accidents.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*tq83J5fK3_OAWChRqJJ_6Q.png"/></figure> <p>As is clearly shown in the graphic, by far the most relevant feature was SENTIDO_1F when the value was 4. When SENTIDO_1F is equal to 1 it means that the vehicle was going in the direction that augments the kilometric point of the road, 2 when its in the opposite direction, 3 when both and 4 when unknown.</p> <p>When SENTIDO_1Fis unknown is most probably because <strong>the road itself doesn&#39;t have kilometric points</strong>. In Spain, those roads are <strong>basically urban roads and the highways, which we know for the statistical analysis that are the ones with lower fatality rates</strong>.</p> <p>This makes much sense as basically this feature indicates that the <strong>road where the accident happened should be a safe road</strong>.</p> <p>In this regard we also see in the top20 features like inStreet or TIPO_VIA_9 which clearly indicate <strong>streets</strong>.</p> <p>On the other hand we also see features like the number of vehicles taking part in the accident (TOTAL_VEHICULOS). We can explore this later.</p> <p>Other interesting findings are CONDICION_ILUMINACION_6 which means that there was <strong>no artificial or natural light in the accident (may lead to think about nightime)</strong> or ACERA_998 which means that the information about the <strong>sidewalk does not apply (may lead to think about interurban roads)</strong>.</p> <p>Another repeated column in the features with most importance seems to be the accident type. Because of that, I wanted to see the feature importance of the type of accidents and type of roads.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*w8U3OKBaNoY8gUktN3krbw.png"/></figure> <p>We basically see 5 types of accidents with the highest feature importance.</p> <ul><li><strong>Type 1:</strong> Frontal crash</li><li><strong>Type 10:</strong> Fall</li><li><strong>Type 4:</strong> Read-end</li><li><strong>Type 16:</strong> Run-off-road with crash to the right side</li><li><strong>Type 8: </strong>Animal runover</li></ul> <p>It’s interesting to see that type pedestrian runover doesn’t have importance in predicting the fatality of an accident when there are so many pedestrian deads due to these type of accidents.</p> <p>Looking at our descriptive statistics from before, we can tell that probably a <strong>frontal crash or a run-off-road with crash to the right side will predict a fatal accident</strong> and that a <strong>fall, a rear-end or an animal runover may predict a non fatal accident</strong>.</p> <p>I also wanted to look again at the importance of the features related with the type of the road, which showed me again that if accidents happen in streets is the only type of road that is important in order to predict (non-)fatal accidents.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*fUorXzFgvdIvqqf_4RQHRA.png"/></figure> <p>To finish, I wanted to look deeper at the TOTAL_VEHICULOS feature.</p> <p>Let’s see in a plot how the fatality rate evolves in relationship with the total amount of vehicles involved in an accident.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/649/1*Xm_ngS9TSRRvHSRNOXJ2EQ.png"/></figure> <p>The graphic shows us that for most fatal accidents, surprisingly the more frequent feature is only one vehicle involved.</p> <p>Let’s see fatal accidents with just one vehicle involved by accident type.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/630/1*dtxNDQUFHYQq31Hy0AdQpg.png"/></figure> <p>We see that they are mostly pedestrian hits and run-off-road accidents.</p> <p>To conclude with this small experiment, we can say:</p> <ul><li><strong>Weekends and holiday seasons are more likely to have fatal accidents, specially in the night. </strong>We see a correlation of this with the deployment of special controls by police officers for example.</li><li><strong>Fatal accidents use to happen in inter-urban roads, specially in single-lane roads. </strong>The administration has already a track record of measures working to reduce the fatality rate in inter-urban roads with the installation of speed cameras, speed-enforcement zones, reduction of speed limits in inter-urban roads, etc.</li><li><strong>Most fatal accidents are frontal collisions followed by run-off-road collisions and pedestrian hits. </strong>The homologation of vehicles is very strict in Europe regarding pedestrian hit security. Also, we see certifications like EuroNCAP evaluating the security of vehicles against many different accidents.</li><li><strong>Pedestrians, cyclists and motorbike riders/passengers are more likely to die in an accident than other groups on the road. </strong>There is still room to improve in working towards the security of most vulnerable road users, but we have seen already some changes in the laws to improve it.</li></ul> <p>Luckily we can say that our administrations have in their hands already useful data to make our roads more secure, and measures are already being implement. Besides that is always good to remind that it is a collective work to try to avoid any loss of lives in the road.</p> <p>As conclusions of the project, I can say that <strong>Open Data can clearly help to improve the security of the roads</strong>. Accessible data like the one in the dataset used may help other data science enthusiasts and professionals in different industries help solve this and other problems that sadly still exist.</p> <p>Personally this project has been a great experience to learn more about classification models and its optimisation, and also to learn more about the road accidents that sadly still kill too many people in Spain.</p> <p>All the code can be found in my <a href="https://github.com/anrodon/predicting-road-accidents-in-spain">Github</a> profile.</p> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=8d3ae7c4d4c2" width="1" height="1" alt=""/></p>]]></content><author><name></name></author></entry><entry><title type="html">Spain’s bumpy road towards electrification</title><link href="https://anrodon.github.io/blog/2025/spains-bumpy-road-towards-electrification/" rel="alternate" type="text/html" title="Spain’s bumpy road towards electrification"/><published>2025-04-07T09:22:15+00:00</published><updated>2025-04-07T09:22:15+00:00</updated><id>https://anrodon.github.io/blog/2025/spains-bumpy-road-towards-electrification</id><content type="html" xml:base="https://anrodon.github.io/blog/2025/spains-bumpy-road-towards-electrification/"><![CDATA[<h4>What the last 12 months of car registrations in Spain tells us about its path to a zero-emissions car park</h4> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*kqmhNQmBDYg-bUsQwl1LWw.jpeg"/></figure> <p>The automotive industry is undergoing one of the most significant transformation periods in its history. New propulsion systems, regulations, consumer demands, and other factors are challenging the status quo of this century-old industry.</p> <p>According to the European Commission, <strong>passenger cars are responsible for around 16% of the total CO2 emissions in Europe</strong>, and because of that, the European administration has set <a href="https://climate.ec.europa.eu/eu-action/transport/road-transport-reducing-co2-emissions-vehicles/co2-emission-performance-standards-cars-and-vans_en">fleet-wide CO2 emission targets</a> to contribute to reaching at least 55% net greenhouse gas emission reductions by 2030 compared to 1990 as well as achieving climate neutrality by 2050, in line with the <a href="https://climate.ec.europa.eu/eu-action/european-climate-law_en">European Climate Law</a>.</p> <p><strong>Spain is the second largest passenger car producer in Europe </strong>(behind Germany) and the automotive industry generates approximately the 7% of the Spanish GDP. But Spain is not only a major automobile producer; it is also a significant consumer market for cars, with <strong>yearly registration figures close to 1 million vehicles</strong>.</p> <p>The Spanish General Traffic Administration (<a href="https://www.dgt.es/">DGT — Dirección General de Tráfico</a>) has an Open Data portal called <a href="https://www.dgt.es/menusecundario/dgt-en-cifras/">DGT en Cifras</a>, which allow everyone to download various data related to car registrations, drivers, fines, and other interesting topics related to the spanish car park.</p> <p>I was curious about analyzing one of its datasets storing microdata of the registered cars for each month (<a href="https://www.dgt.es/menusecundario/dgt-en-cifras/dgt-en-cifras-resultados/dgt-en-cifras-detalle/Microdatos-de-parque-de-vehiculos-anual/">Microdatos de Matriculaciones de Vehículos (mensual)</a>) and the results of this analysis show a really sad reality: <strong>the spanish market is not choosing to purchase zero-emissions vehicles</strong>.</p> <p>Before starting to work with the data, I wrote four questions to guide my analysis:</p> <ol><li><strong>Are the Spanish costumers purchasing electrified vehicles?</strong></li><li><strong>Which Spanish provinces have the biggest and smallest number of electrified vehicles registrations?</strong></li><li><strong>Which Spanish provinces are registering more and fewer polluting vehicles?</strong></li><li><strong>Which car brands are selling more and fewer ecological cars in Spain?</strong></li></ol> <p>These questions were written with the aim of assessing if the spanish car consumers are taking or not into account the CO2 emissions when purchasing a new car. Because of that, we only took into account new passenger cars from the dataset (we did not include commercial vehicles, vans, industrial machinery, etc and neither used cars being registered again).</p> <p><strong>The data used has been from March 2024 to February 2025 (last 12 available months of data).</strong></p> <p>In regards of the first question the situation is the following:</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/436/1*xClqZEZfCTbykCgLfNbRpw.png"/></figure> <p>Even though <strong>HEV cars</strong> (Hybrid Electric Vehicles — gas cars with electric motor support) <strong>are the ones being registered the most</strong>, <strong>PHEV </strong>(Plug-in Hybrid Electric Vehicles) <strong>and BEV</strong> (Battery Electric Vehicles) <strong>together account for only 11.3% of the registrations, with only 6.1% being fully electric</strong>. This indicates that Spain still has a long way to go to reach zero-emission registrations.</p> <p>With the second question, <strong>“Which Spanish provinces have the highest and lowest number of electrified vehicle registrations?”</strong>, I tried to delve deeper into the dataset.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/868/1*RW6hoQZ7Ltru0C8WuXKAoQ.png"/></figure> <p>With the graphic above, I saw that the capital <strong>Madrid is the clear winner in terms of zero-emissions vehicle registrations</strong>, followed by big cities like Barcelona or Valencia. The top 10 bar graph states the same:</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/868/1*6D4V7YVQRawVkr_QeOOCpw.png"/></figure> <p>The capital of the country being so different from the other regions was a bit suspicious to me, so I started to think that the large numbers might be related to fleets (rental cars, leasing, etc.) of companies registered there.</p> <p>Luckily, our dataset differentiated vehicles registered by natural and legal persons, so we could find the answer to confirm or reject my hypothesis.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/868/1*U1YiODustEYW92GhXGN2Qg.png"/></figure> <p>Looking at the graphic, <strong>Madrid and Barcelona had a large proportion of cars registered by legal entities</strong>, but I still wanted to know which of those cars were actually destined to be driven by customers who chose that kind of car (I didn’t want to take into account company fleets, for example).</p> <p>Another interesting field in the dataset indicates whether the car is a renting car or not, so I could use it to separate the cars actually being driven by actual end customers from the other company cars.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/868/1*CxmkdAfwGug5zvK-P9xgYw.png"/></figure> <p>This last graphic made me see that our second question was not going to be answered with the data that we had. We see that <strong>most of the PHEV and BEV cars registered by companies in Madrid are for Renting</strong> (probably because most of the banks and renting companies in Spain are registered in Madrid), so <strong>close to half of the PHEV and BEV cars registered in Madrid are probably to be driven by renting customers in other areas of Spain</strong>.</p> <p>So, we have an answer for our second question as we know that <strong>Madrid is the province registering more electrified cars, but the customer behind the wheel may not be driving it in the capital</strong>.</p> <p>To complement this half answered question, I made a ratio of cars per habitant of each of the top 5 provinces registering more PHEV and BEV only by natural persons.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/452/1*UARWHSVsb6U88rUh4vIfrg.png"/><figcaption>Top 5 provinces with more PHEV + BEV car registrations by natural persons</figcaption></figure> <p>We can see that <strong>Madrid and Valencia are the leaders in terms of electrified vehicles per capita</strong> and Barcelona, Alicante and Malaga have similar numbers but are a slightly behind. Would be interesting to analize what is driving this behaviour in Madrid and Valencia to be able to implement measures to improve the rates in the other provinces.</p> <p>To answer the third question, “<strong>Which spanish provinces are registering more and less polluting vehicles?”</strong>, I used the field in the dataset that indicates the g Co2/km of each car to have an average for each province.</p> <p>Doing a quick average between all the cars registered, I found that <strong>the average of CO2 emissions for cars registered in Spain for the last 12 months have been 123,09 g Co2/km</strong>.</p> <p><strong>This number is really alarming as the EU Commission target was 95 g Co2/km for 2024 and is 93,6 g Co2/km for 2025 to 2029.</strong></p> <p>To get a bit of feeling of how bad the situation is, I wanted to see the average CO2 emissions of the top 15 sold models.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/434/1*SL1KYBTK4YwRXVuEGFZJHA.png"/><figcaption>Top 15 car models by volume (BASTIDOR_ITV) with its average CO2 emmissions</figcaption></figure> <p>We see that <strong>for the 15 models with more registrations in the last 12 months, only the TOYOTA C-HR has an average g CO2 /km value inside the EU Comission Targets.</strong></p> <p>Now focusing on the provinces, I took the company registered vehicles apart from the analysis to not contaminate the big picture, and printed the average emissions by province.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/850/1*vkP7t6hIPhoWGXRyMuHR-Q.png"/></figure> <p>Bad news again. <strong>Not even one of the provinces in Spain is achieving the average emission targets of the EU Commission for the new cars registered</strong>, but the accumulated fleet-wide average will be worse!</p> <p>Let’s see it even more graphically:</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/803/1*v5yuDQRpE6e1spewWpbxPQ.png"/></figure> <p>In the map above, <strong>the scale is set so all the provinces below the EU Commission targets should be shown in white, and more red as they pass the 95 g CO2/km figure</strong>. All the map is dark red!</p> <p>The map also gives us another sad fact. Before unveiling it, let’s see another bar graphic that may help identify it.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/850/1*e38CGrW87Lp1qJgCzI-gUw.png"/></figure> <p><strong>The top 10 provinces which registered bigger average CO2 emissions are in the southern part of Spain</strong> (besides the 3 forming Aragón), <strong>which is really sad taking in account the amount of sun hours they get every year which should lead to competitive 100% renewable electricity prices.</strong></p> <p><strong>Again, we see a clear open task for both the central and regional administrations to boost electromobility.</strong></p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/863/1*whzd9jy1LNHUgD3bMU14AA.png"/></figure> <p>We see that Madrid is the city with less CO2 emissions per registered vehicle, but still has a long way to reach the targets of the EU Comission.</p> <p>With this, our third question was answered. Only the fourth question is left: <strong>Which car brands are selling more and less ecological cars in Spain?</strong></p> <p>It is kind of obvious that the companies selling 100% BEVs are the ones selling the more ecological cars, but let’s see them ordered by volumes:</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/868/1*3THNa898CYMrC1LQKJ3RKw.png"/></figure> <p>What we see basically is that <strong>TESLA and BYD are the two brands leading the pack of companies with 100% electrified sales</strong>.</p> <p>But as we have seen, PHEV and BEV car registrations amount for a bit more than 10% of the market. Let’s see what happens with all the other cars. For my last graphic, I wanted to focus just on those brands who register more than 1.000 cars in the last 12 months in Spain.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/891/1*3amok46-j8w8D2QcCLQn8A.png"/></figure> <p><strong>From all the brands selling more than 1.000 cars in the last 12 months, only TESLA, BYD and MINI are registering an average of g CO2/km below the EU Comission Targets.</strong></p> <p>In my opinion, this is not something that the other brands are happy about. Most of them share proudly the vision of a future for the automotive industry with only zero-emissions vehicles, have invested lots of money into developing this kind of cars and spend a lot into advertising of their electric models.</p> <p><strong>What this analysis shows is that the market in Spain is not choosing the electromobility options that the brands offer, and this is something that the spanish administrations should be really worried about.</strong></p> <h4><strong>It is urgent that the spanish market has the right incentives to buy zero-emission cars, not only to save the spanish automotive sector which is one of the most importants in the country, but to ensure that the future generations have a planet where to drive their cars too.</strong></h4> <p><em>The full analysis and the code used can be found in this </em><a href="https://github.com/anrodon/spanish-vehicle-registrations-analysis/tree/main"><em>Github Repo</em></a></p> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=86d4b5b7e838" width="1" height="1" alt=""/></p>]]></content><author><name></name></author></entry><entry><title type="html">a post with plotly.js</title><link href="https://anrodon.github.io/blog/2025/plotly/" rel="alternate" type="text/html" title="a post with plotly.js"/><published>2025-03-26T14:24:00+00:00</published><updated>2025-03-26T14:24:00+00:00</updated><id>https://anrodon.github.io/blog/2025/plotly</id><content type="html" xml:base="https://anrodon.github.io/blog/2025/plotly/"><![CDATA[<p>This is an example post with some <a href="https://plotly.com/javascript/">plotly</a> code.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">plotly
</span><span class="sb">{
  "data": [
    {
      "x": [1, 2, 3, 4],
      "y": [10, 15, 13, 17],
      "type": "scatter"
    },
    {
      "x": [1, 2, 3, 4],
      "y": [16, 5, 11, 9],
      "type": "scatter"
    }
  ]
}</span>
<span class="p">```</span>
</code></pre></div></div> <p>Which generates:</p> <pre><code class="language-plotly">{
  "data": [
    {
      "x": [1, 2, 3, 4],
      "y": [10, 15, 13, 17],
      "type": "scatter"
    },
    {
      "x": [1, 2, 3, 4],
      "y": [16, 5, 11, 9],
      "type": "scatter"
    }
  ]
}
</code></pre> <p>Also another example chart.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">plotly
</span><span class="sb">{
  "data": [
    {
      "x": [1, 2, 3, 4],
      "y": [10, 15, 13, 17],
      "mode": "markers"
    },
    {
      "x": [2, 3, 4, 5],
      "y": [16, 5, 11, 9],
      "mode": "lines"
    },
    {
      "x": [1, 2, 3, 4],
      "y": [12, 9, 15, 12],
      "mode": "lines+markers"
    }
  ],
  "layout": {
    "title": {
      "text": "Line and Scatter Plot"
    }
  }
}</span>
<span class="p">```</span>
</code></pre></div></div> <p>This is how it looks like:</p> <pre><code class="language-plotly">{
  "data": [
    {
      "x": [1, 2, 3, 4],
      "y": [10, 15, 13, 17],
      "mode": "markers"
    },
    {
      "x": [2, 3, 4, 5],
      "y": [16, 5, 11, 9],
      "mode": "lines"
    },
    {
      "x": [1, 2, 3, 4],
      "y": [12, 9, 15, 12],
      "mode": "lines+markers"
    }
  ],
  "layout": {
    "title": {
      "text": "Line and Scatter Plot"
    }
  }
}
</code></pre>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="charts"/><summary type="html"><![CDATA[this is what included plotly.js code could look like]]></summary></entry><entry><title type="html">a post with image galleries</title><link href="https://anrodon.github.io/blog/2024/photo-gallery/" rel="alternate" type="text/html" title="a post with image galleries"/><published>2024-12-04T01:59:00+00:00</published><updated>2024-12-04T01:59:00+00:00</updated><id>https://anrodon.github.io/blog/2024/photo-gallery</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/photo-gallery/"><![CDATA[<p>The images in this post are all zoomable, arranged into different mini-galleries using different libraries.</p> <h2 id="lightbox2"><a href="https://lokeshdhakar.com/projects/lightbox2/">Lightbox2</a></h2> <p><a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-2500.jpg" data-lightbox="roadtrip"><img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-200.jpg"/></a> <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-2500.jpg" data-lightbox="roadtrip"><img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-200.jpg"/></a> <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-2500.jpg" data-lightbox="roadtrip"><img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-200.jpg"/></a></p> <hr/> <h2 id="photoswipe"><a href="https://photoswipe.com/">PhotoSwipe</a></h2> <div class="pswp-gallery pswp-gallery--single-column" id="gallery--getting-started"> <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-2500.jpg" data-pswp-width="1669" data-pswp-height="2500" target="_blank"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-200.jpg" alt=""/> </a> <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/7/img-2500.jpg" data-pswp-width="1875" data-pswp-height="2500" data-cropped="true" target="_blank"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/7/img-200.jpg" alt=""/> </a> <a href="https://unsplash.com" data-pswp-src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-2500.jpg" data-pswp-width="2500" data-pswp-height="1666" target="_blank"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-200.jpg" alt=""/> </a> <div> <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/6/img-2500.jpg" data-pswp-width="2500" data-pswp-height="1667" target="_blank"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/6/img-200.jpg" alt=""/> </a> </div> </div> <hr/> <h2 id="spotlight-js"><a href="https://nextapps-de.github.io/spotlight/">Spotlight JS</a></h2> <div class="spotlight-group"> <a class="spotlight" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-2500.jpg"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-200.jpg"/> </a> <a class="spotlight" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-2500.jpg"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-200.jpg"/> </a> <a class="spotlight" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-2500.jpg"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-200.jpg"/> </a> </div> <div class="spotlight-group"> <a class="spotlight" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/4/img-2500.jpg"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/4/img-200.jpg"/> </a> <a class="spotlight" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/5/img-2500.jpg"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/5/img-200.jpg"/> </a> <a class="spotlight" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/6/img-2500.jpg"> <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/6/img-200.jpg"/> </a> </div> <hr/> <h2 id="venobox"><a href="https://veno.es/venobox/">Venobox</a></h2> <p><a class="venobox" data-gall="myGallery" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-2500.jpg"><img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-200.jpg"/></a> <a class="venobox" data-gall="myGallery" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-2500.jpg"><img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-200.jpg"/></a> <a class="venobox" data-gall="myGallery" href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-2500.jpg"><img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-200.jpg"/></a></p>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="images"/><summary type="html"><![CDATA[this is what included image galleries could look like]]></summary></entry><entry><title type="html">a post with tabs</title><link href="https://anrodon.github.io/blog/2024/tabs/" rel="alternate" type="text/html" title="a post with tabs"/><published>2024-05-01T00:32:13+00:00</published><updated>2024-05-01T00:32:13+00:00</updated><id>https://anrodon.github.io/blog/2024/tabs</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/tabs/"><![CDATA[<p>This is how a post with <a href="https://github.com/Ovski4/jekyll-tabs">tabs</a> looks like. Note that the tabs could be used for different purposes, not only for code.</p> <h2 id="first-tabs">First tabs</h2> <p>To add tabs, use the following syntax:</p> <div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{%</span><span class="w"> </span><span class="nt">tabs</span><span class="w"> </span><span class="nv">group-name</span><span class="w"> </span><span class="cp">%}</span>

<span class="cp">{%</span><span class="w"> </span><span class="nt">tab</span><span class="w"> </span><span class="nv">group-name</span><span class="w"> </span><span class="nv">tab-name-1</span><span class="w"> </span><span class="cp">%}</span>

Content 1

<span class="cp">{%</span><span class="w"> </span><span class="nt">endtab</span><span class="w"> </span><span class="cp">%}</span>

<span class="cp">{%</span><span class="w"> </span><span class="nt">tab</span><span class="w"> </span><span class="nv">group-name</span><span class="w"> </span><span class="nv">tab-name-2</span><span class="w"> </span><span class="cp">%}</span>

Content 2

<span class="cp">{%</span><span class="w"> </span><span class="nt">endtab</span><span class="w"> </span><span class="cp">%}</span>

<span class="cp">{%</span><span class="w"> </span><span class="nt">endtabs</span><span class="w"> </span><span class="cp">%}</span>
</code></pre></div></div> <p>With this you can generate visualizations like:</p> <ul id="log" class="tab" data-tab="fb0ac631-95fe-4845-a844-1fcd9922cad6" data-name="log"> <li class="active" id="log-php"> <a href="#">php </a> </li> <li id="log-js"> <a href="#">js </a> </li> <li id="log-ruby"> <a href="#">ruby </a> </li> </ul> <ul class="tab-content" id="fb0ac631-95fe-4845-a844-1fcd9922cad6" data-name="log"> <li class="active"> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">var_dump</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">);</span>
</code></pre></div></div> </li> <li> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">hello</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div> </li> <li> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pputs</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
</code></pre></div></div> </li> </ul> <h2 id="another-example">Another example</h2> <ul id="data-struct" class="tab" data-tab="a1b32cb7-7c77-4fbf-957c-10ca12300275" data-name="data-struct"> <li class="active" id="data-struct-yaml"> <a href="#">yaml </a> </li> <li id="data-struct-json"> <a href="#">json </a> </li> </ul> <ul class="tab-content" id="a1b32cb7-7c77-4fbf-957c-10ca12300275" data-name="data-struct"> <li class="active"> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">hello</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">whatsup"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">hi"</span>
</code></pre></div></div> </li> <li> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"hello"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"whatsup"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hi"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> </li> </ul> <h2 id="tabs-for-something-else">Tabs for something else</h2> <ul id="something-else" class="tab" data-tab="ab1e0edd-da6a-4e39-b032-74460e842a4f" data-name="something-else"> <li class="active" id="something-else-text"> <a href="#">text </a> </li> <li id="something-else-quote"> <a href="#">quote </a> </li> <li id="something-else-list"> <a href="#">list </a> </li> </ul> <ul class="tab-content" id="ab1e0edd-da6a-4e39-b032-74460e842a4f" data-name="something-else"> <li class="active"> <p>Regular text</p> </li> <li> <blockquote> <p>A quote</p> </blockquote> </li> <li> <p>Hipster list</p> <ul> <li>brunch</li> <li>fixie</li> <li>raybans</li> <li>messenger bag</li> </ul> </li> </ul>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="code"/><summary type="html"><![CDATA[this is what included tabs in a post could look like]]></summary></entry><entry><title type="html">a post with typograms</title><link href="https://anrodon.github.io/blog/2024/typograms/" rel="alternate" type="text/html" title="a post with typograms"/><published>2024-04-29T23:36:10+00:00</published><updated>2024-04-29T23:36:10+00:00</updated><id>https://anrodon.github.io/blog/2024/typograms</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/typograms/"><![CDATA[<p>This is an example post with some <a href="https://github.com/google/typograms/">typograms</a> code.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">typograms
</span><span class="sb">+----+
|    |---&gt; My first diagram!
+----+</span>
<span class="p">```</span>
</code></pre></div></div> <p>Which generates:</p> <pre><code class="language-typograms">+----+
|    |---&gt; My first diagram!
+----+
</code></pre> <p>Another example:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">typograms
</span><span class="sb">.------------------------.
|.----------------------.|
||"https://example.com" ||
|'----------------------'|
| ______________________ |
||                      ||
||   Welcome!           ||
||                      ||
||                      ||
||  .----------------.  ||
||  | username       |  ||
||  '----------------'  ||
||  .----------------.  ||
||  |"*******"       |  ||
||  '----------------'  ||
||                      ||
||  .----------------.  ||
||  |   "Sign-up"    |  ||
||  '----------------'  ||
||                      ||
|+----------------------+|
.------------------------.</span>
<span class="p">```</span>
</code></pre></div></div> <p>which generates:</p> <pre><code class="language-typograms">.------------------------.
|.----------------------.|
||"https://example.com" ||
|'----------------------'|
| ______________________ |
||                      ||
||   Welcome!           ||
||                      ||
||                      ||
||  .----------------.  ||
||  | username       |  ||
||  '----------------'  ||
||  .----------------.  ||
||  |"*******"       |  ||
||  '----------------'  ||
||                      ||
||  .----------------.  ||
||  |   "Sign-up"    |  ||
||  '----------------'  ||
||                      ||
|+----------------------+|
.------------------------.
</code></pre> <p>For more examples, check out the <a href="https://google.github.io/typograms/#examples">typograms documentation</a>.</p>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="diagrams"/><summary type="html"><![CDATA[this is what included typograms code could look like]]></summary></entry><entry><title type="html">a post that can be cited</title><link href="https://anrodon.github.io/blog/2024/post-citation/" rel="alternate" type="text/html" title="a post that can be cited"/><published>2024-04-28T15:06:00+00:00</published><updated>2024-04-28T15:06:00+00:00</updated><id>https://anrodon.github.io/blog/2024/post-citation</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/post-citation/"><![CDATA[<p>This is an example post that can be cited. The content of the post ends here, while the citation information is automatically provided below. The only thing needed is for you to set the <code class="language-plaintext highlighter-rouge">citation</code> key in the front matter to <code class="language-plaintext highlighter-rouge">true</code>.</p>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="citation"/><summary type="html"><![CDATA[this is what a post that can be cited looks like]]></summary></entry><entry><title type="html">a post with pseudo code</title><link href="https://anrodon.github.io/blog/2024/pseudocode/" rel="alternate" type="text/html" title="a post with pseudo code"/><published>2024-04-15T00:01:00+00:00</published><updated>2024-04-15T00:01:00+00:00</updated><id>https://anrodon.github.io/blog/2024/pseudocode</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/pseudocode/"><![CDATA[<p>This is an example post with some pseudo code rendered by <a href="https://github.com/SaswatPadhi/pseudocode.js">pseudocode</a>. The example presented here is the same as the one in the <a href="https://saswat.padhi.me/pseudocode.js/">pseudocode.js</a> documentation, with only one simple but important change: everytime you would use <code class="language-plaintext highlighter-rouge">$</code>, you should use <code class="language-plaintext highlighter-rouge">$$</code> instead. Also, note that the <code class="language-plaintext highlighter-rouge">pseudocode</code> key in the front matter is set to <code class="language-plaintext highlighter-rouge">true</code> to enable the rendering of pseudo code. As an example, using this code:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">pseudocode
</span><span class="sb">% This quicksort algorithm is extracted from Chapter 7, Introduction to Algorithms (3rd edition)
\begin{algorithm}
\caption{Quicksort}
\begin{algorithmic}
\PROCEDURE{Quicksort}{$$A, p, r$$}
    \IF{$$p &lt; r$$}
        \STATE $$q = $$ \CALL{Partition}{$$A, p, r$$}
        \STATE \CALL{Quicksort}{$$A, p, q - 1$$}
        \STATE \CALL{Quicksort}{$$A, q + 1, r$$}
    \ENDIF
\ENDPROCEDURE
\PROCEDURE{Partition}{$$A, p, r$$}
    \STATE $$x = A[r]$$
    \STATE $$i = p - 1$$
    \FOR{$$j = p$$ \TO $$r - 1$$}
        \IF{$$A[j] &lt; x$$}
            \STATE $$i = i + 1$$
            \STATE exchange
            $$A[i]$$ with $$A[j]$$
        \ENDIF
        \STATE exchange $$A[i]$$ with $$A[r]$$
    \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}</span>
<span class="p">```</span>
</code></pre></div></div> <p>Generates:</p> <pre><code class="language-pseudocode">% This quicksort algorithm is extracted from Chapter 7, Introduction to Algorithms (3rd edition)
\begin{algorithm}
\caption{Quicksort}
\begin{algorithmic}
\PROCEDURE{Quicksort}{$$A, p, r$$}
    \IF{$$p &lt; r$$}
        \STATE $$q = $$ \CALL{Partition}{$$A, p, r$$}
        \STATE \CALL{Quicksort}{$$A, p, q - 1$$}
        \STATE \CALL{Quicksort}{$$A, q + 1, r$$}
    \ENDIF
\ENDPROCEDURE
\PROCEDURE{Partition}{$$A, p, r$$}
    \STATE $$x = A[r]$$
    \STATE $$i = p - 1$$
    \FOR{$$j = p$$ \TO $$r - 1$$}
        \IF{$$A[j] &lt; x$$}
            \STATE $$i = i + 1$$
            \STATE exchange
            $$A[i]$$ with $$A[j]$$
        \ENDIF
        \STATE exchange $$A[i]$$ with $$A[r]$$
    \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</code></pre>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="code"/><summary type="html"><![CDATA[this is what included pseudo code could look like]]></summary></entry><entry><title type="html">a post with code diff</title><link href="https://anrodon.github.io/blog/2024/code-diff/" rel="alternate" type="text/html" title="a post with code diff"/><published>2024-01-27T19:22:00+00:00</published><updated>2024-01-27T19:22:00+00:00</updated><id>https://anrodon.github.io/blog/2024/code-diff</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/code-diff/"><![CDATA[<p>You can display diff code by using the regular markdown syntax:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">diff
</span><span class="gh">diff --git a/sample.js b/sample.js
index 0000001..0ddf2ba
</span><span class="gd">--- a/sample.js
</span><span class="gi">+++ b/sample.js
</span><span class="p">@@ -1 +1 @@</span>
<span class="gd">-console.log("Hello World!")
</span><span class="gi">+console.log("Hello from Diff2Html!")</span>
<span class="p">```</span>
</code></pre></div></div> <p>Which generates:</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/sample.js b/sample.js
index 0000001..0ddf2ba
</span><span class="gd">--- a/sample.js
</span><span class="gi">+++ b/sample.js
</span><span class="p">@@ -1 +1 @@</span>
<span class="gd">-console.log("Hello World!")
</span><span class="gi">+console.log("Hello from Diff2Html!")
</span></code></pre></div></div> <p>But this is difficult to read, specially if you have a large diff. You can use <a href="https://diff2html.xyz/">diff2html</a> to display a more readable version of the diff. For this, just use <code class="language-plaintext highlighter-rouge">diff2html</code> instead of <code class="language-plaintext highlighter-rouge">diff</code> for the code block language:</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">diff2html
</span><span class="sb">diff --git a/sample.js b/sample.js
index 0000001..0ddf2ba
--- a/sample.js
+++ b/sample.js
@@ -1 +1 @@
-console.log("Hello World!")
+console.log("Hello from Diff2Html!")</span>
<span class="p">```</span>
</code></pre></div></div> <p>If we use a longer example, for example <a href="https://github.com/rtfpessoa/diff2html/commit/c2c253d3e3f8b8b267f551e659f72b44ca2ac927">this commit from diff2html</a>, it will generate the following output:</p> <pre><code class="language-diff2html">From 2aaae31cc2a37bfff83430c2c914b140bee59b6a Mon Sep 17 00:00:00 2001
From: Rodrigo Fernandes &lt;rtfrodrigo@gmail.com&gt;
Date: Sun, 9 Oct 2016 16:41:54 +0100
Subject: [PATCH 1/2] Initial template override support

---
 scripts/hulk.js                    |  4 ++--
 src/diff2html.js                   |  3 +--
 src/file-list-printer.js           | 11 ++++++++---
 src/hoganjs-utils.js               | 29 +++++++++++++++++------------
 src/html-printer.js                |  6 ++++++
 src/line-by-line-printer.js        |  6 +++++-
 src/side-by-side-printer.js        |  6 +++++-
 test/file-list-printer-tests.js    |  2 +-
 test/hogan-cache-tests.js          | 18 +++++++++++++++---
 test/line-by-line-tests.js         |  3 +--
 test/side-by-side-printer-tests.js |  3 +--
 11 files changed, 62 insertions(+), 29 deletions(-)

diff --git a/scripts/hulk.js b/scripts/hulk.js
index 5a793c18..a4b1a4d5 100755
--- a/scripts/hulk.js
+++ b/scripts/hulk.js
@@ -173,11 +173,11 @@ function namespace(name) {
 // write a template foreach file that matches template extension
 templates = extractFiles(options.argv.remain)
   .map(function(file) {
-    var openedFile = fs.readFileSync(file, 'utf-8');
+    var openedFile = fs.readFileSync(file, 'utf-8').trim();
     var name;
     if (!openedFile) return;
     name = namespace(path.basename(file).replace(/\..*$/, ''));
-    openedFile = removeByteOrderMark(openedFile.trim());
+    openedFile = removeByteOrderMark(openedFile);
     openedFile = wrap(file, name, openedFile);
     if (!options.outputdir) return openedFile;
     fs.writeFileSync(path.join(options.outputdir, name + '.js')
diff --git a/src/diff2html.js b/src/diff2html.js
index 21b0119e..64e138f5 100644
--- a/src/diff2html.js
+++ b/src/diff2html.js
@@ -7,7 +7,6 @@

 (function() {
   var diffParser = require('./diff-parser.js').DiffParser;
-  var fileLister = require('./file-list-printer.js').FileListPrinter;
   var htmlPrinter = require('./html-printer.js').HtmlPrinter;

   function Diff2Html() {
@@ -43,7 +42,7 @@

     var fileList = '';
     if (configOrEmpty.showFiles === true) {
-      fileList = fileLister.generateFileList(diffJson, configOrEmpty);
+      fileList = htmlPrinter.generateFileListSummary(diffJson, configOrEmpty);
     }

     var diffOutput = '';
diff --git a/src/file-list-printer.js b/src/file-list-printer.js
index e408d9b2..1e0a2c61 100644
--- a/src/file-list-printer.js
+++ b/src/file-list-printer.js
@@ -8,11 +8,16 @@
 (function() {
   var printerUtils = require('./printer-utils.js').PrinterUtils;

-  var hoganUtils = require('./hoganjs-utils.js').HoganJsUtils;
+  var hoganUtils;
+
   var baseTemplatesPath = 'file-summary';
   var iconsBaseTemplatesPath = 'icon';

-  function FileListPrinter() {
+  function FileListPrinter(config) {
+    this.config = config;
+
+    var HoganJsUtils = require('./hoganjs-utils.js').HoganJsUtils;
+    hoganUtils = new HoganJsUtils(config);
   }

   FileListPrinter.prototype.generateFileList = function(diffFiles) {
@@ -38,5 +43,5 @@
     });
   };

-  module.exports.FileListPrinter = new FileListPrinter();
+  module.exports.FileListPrinter = FileListPrinter;
 })();
diff --git a/src/hoganjs-utils.js b/src/hoganjs-utils.js
index 9949e5fa..0dda08d7 100644
--- a/src/hoganjs-utils.js
+++ b/src/hoganjs-utils.js
@@ -8,18 +8,19 @@
 (function() {
   var fs = require('fs');
   var path = require('path');
-
   var hogan = require('hogan.js');

   var hoganTemplates = require('./templates/diff2html-templates.js');

-  var templatesPath = path.resolve(__dirname, 'templates');
+  var extraTemplates;

-  function HoganJsUtils() {
+  function HoganJsUtils(configuration) {
+    this.config = configuration || {};
+    extraTemplates = this.config.templates || {};
   }

-  HoganJsUtils.prototype.render = function(namespace, view, params, configuration) {
-    var template = this.template(namespace, view, configuration);
+  HoganJsUtils.prototype.render = function(namespace, view, params) {
+    var template = this.template(namespace, view);
     if (template) {
       return template.render(params);
     }
@@ -27,17 +28,16 @@
     return null;
   };

-  HoganJsUtils.prototype.template = function(namespace, view, configuration) {
-    var config = configuration || {};
+  HoganJsUtils.prototype.template = function(namespace, view) {
     var templateKey = this._templateKey(namespace, view);

-    return this._getTemplate(templateKey, config);
+    return this._getTemplate(templateKey);
   };

-  HoganJsUtils.prototype._getTemplate = function(templateKey, config) {
+  HoganJsUtils.prototype._getTemplate = function(templateKey) {
     var template;

-    if (!config.noCache) {
+    if (!this.config.noCache) {
       template = this._readFromCache(templateKey);
     }

@@ -53,6 +53,7 @@

     try {
       if (fs.readFileSync) {
+        var templatesPath = path.resolve(__dirname, 'templates');
         var templatePath = path.join(templatesPath, templateKey);
         var templateContent = fs.readFileSync(templatePath + '.mustache', 'utf8');
         template = hogan.compile(templateContent);
@@ -66,12 +67,16 @@
   };

   HoganJsUtils.prototype._readFromCache = function(templateKey) {
-    return hoganTemplates[templateKey];
+    return extraTemplates[templateKey] || hoganTemplates[templateKey];
   };

   HoganJsUtils.prototype._templateKey = function(namespace, view) {
     return namespace + '-' + view;
   };

-  module.exports.HoganJsUtils = new HoganJsUtils();
+  HoganJsUtils.prototype.compile = function(templateStr) {
+    return hogan.compile(templateStr);
+  };
+
+  module.exports.HoganJsUtils = HoganJsUtils;
 })();
diff --git a/src/html-printer.js b/src/html-printer.js
index 585d5b66..13f83047 100644
--- a/src/html-printer.js
+++ b/src/html-printer.js
@@ -8,6 +8,7 @@
 (function() {
   var LineByLinePrinter = require('./line-by-line-printer.js').LineByLinePrinter;
   var SideBySidePrinter = require('./side-by-side-printer.js').SideBySidePrinter;
+  var FileListPrinter = require('./file-list-printer.js').FileListPrinter;

   function HtmlPrinter() {
   }
@@ -22,5 +23,10 @@
     return sideBySidePrinter.generateSideBySideJsonHtml(diffFiles);
   };

+  HtmlPrinter.prototype.generateFileListSummary = function(diffJson, config) {
+    var fileListPrinter = new FileListPrinter(config);
+    return fileListPrinter.generateFileList(diffJson);
+  };
+
   module.exports.HtmlPrinter = new HtmlPrinter();
 })();
diff --git a/src/line-by-line-printer.js b/src/line-by-line-printer.js
index b07eb53c..d230bedd 100644
--- a/src/line-by-line-printer.js
+++ b/src/line-by-line-printer.js
@@ -11,7 +11,8 @@
   var utils = require('./utils.js').Utils;
   var Rematch = require('./rematch.js').Rematch;

-  var hoganUtils = require('./hoganjs-utils.js').HoganJsUtils;
+  var hoganUtils;
+
   var genericTemplatesPath = 'generic';
   var baseTemplatesPath = 'line-by-line';
   var iconsBaseTemplatesPath = 'icon';
@@ -19,6 +20,9 @@

   function LineByLinePrinter(config) {
     this.config = config;
+
+    var HoganJsUtils = require('./hoganjs-utils.js').HoganJsUtils;
+    hoganUtils = new HoganJsUtils(config);
   }

   LineByLinePrinter.prototype.makeFileDiffHtml = function(file, diffs) {
diff --git a/src/side-by-side-printer.js b/src/side-by-side-printer.js
index bbf1dc8d..5e3033b3 100644
--- a/src/side-by-side-printer.js
+++ b/src/side-by-side-printer.js
@@ -11,7 +11,8 @@
   var utils = require('./utils.js').Utils;
   var Rematch = require('./rematch.js').Rematch;

-  var hoganUtils = require('./hoganjs-utils.js').HoganJsUtils;
+  var hoganUtils;
+
   var genericTemplatesPath = 'generic';
   var baseTemplatesPath = 'side-by-side';
   var iconsBaseTemplatesPath = 'icon';
@@ -26,6 +27,9 @@

   function SideBySidePrinter(config) {
     this.config = config;
+
+    var HoganJsUtils = require('./hoganjs-utils.js').HoganJsUtils;
+    hoganUtils = new HoganJsUtils(config);
   }

   SideBySidePrinter.prototype.makeDiffHtml = function(file, diffs) {
diff --git a/test/file-list-printer-tests.js b/test/file-list-printer-tests.js
index a502a46f..60ea3208 100644
--- a/test/file-list-printer-tests.js
+++ b/test/file-list-printer-tests.js
@@ -1,6 +1,6 @@
 var assert = require('assert');

-var fileListPrinter = require('../src/file-list-printer.js').FileListPrinter;
+var fileListPrinter = new (require('../src/file-list-printer.js').FileListPrinter)();

 describe('FileListPrinter', function() {
   describe('generateFileList', function() {
diff --git a/test/hogan-cache-tests.js b/test/hogan-cache-tests.js
index 190bf6f8..3bb754ac 100644
--- a/test/hogan-cache-tests.js
+++ b/test/hogan-cache-tests.js
@@ -1,6 +1,6 @@
 var assert = require('assert');

-var HoganJsUtils = require('../src/hoganjs-utils.js').HoganJsUtils;
+var HoganJsUtils = new (require('../src/hoganjs-utils.js').HoganJsUtils)();
 var diffParser = require('../src/diff-parser.js').DiffParser;

 describe('HoganJsUtils', function() {
@@ -21,16 +21,28 @@ describe('HoganJsUtils', function() {
       });
       assert.equal(emptyDiffHtml, result);
     });
+
     it('should render view without cache', function() {
       var result = HoganJsUtils.render('generic', 'empty-diff', {
         contentClass: 'd2h-code-line',
         diffParser: diffParser
       }, {noCache: true});
-      assert.equal(emptyDiffHtml + '\n', result);
+      assert.equal(emptyDiffHtml, result);
     });
+
     it('should return null if template is missing', function() {
-      var result = HoganJsUtils.render('generic', 'missing-template', {}, {noCache: true});
+      var hoganUtils = new (require('../src/hoganjs-utils.js').HoganJsUtils)({noCache: true});
+      var result = hoganUtils.render('generic', 'missing-template', {});
       assert.equal(null, result);
     });
+
+    it('should allow templates to be overridden', function() {
+      var emptyDiffTemplate = HoganJsUtils.compile('&lt;p&gt;&lt;/p&gt;');
+
+      var config = {templates: {'generic-empty-diff': emptyDiffTemplate}};
+      var hoganUtils = new (require('../src/hoganjs-utils.js').HoganJsUtils)(config);
+      var result = hoganUtils.render('generic', 'empty-diff', {myName: 'Rodrigo Fernandes'});
+      assert.equal('&lt;p&gt;Rodrigo Fernandes&lt;/p&gt;', result);
+    });
   });
 });
diff --git a/test/line-by-line-tests.js b/test/line-by-line-tests.js
index 1cd92073..8869b3df 100644
--- a/test/line-by-line-tests.js
+++ b/test/line-by-line-tests.js
@@ -14,7 +14,7 @@ describe('LineByLinePrinter', function() {
         '            File without changes\n' +
         '        &lt;/div&gt;\n' +
         '    &lt;/td&gt;\n' +
-        '&lt;/tr&gt;\n';
+        '&lt;/tr&gt;';

       assert.equal(expected, fileHtml);
     });
@@ -422,7 +422,6 @@ describe('LineByLinePrinter', function() {
         '        &lt;/div&gt;\n' +
         '    &lt;/td&gt;\n' +
         '&lt;/tr&gt;\n' +
-        '\n' +
         '                &lt;/tbody&gt;\n' +
         '            &lt;/table&gt;\n' +
         '        &lt;/div&gt;\n' +
diff --git a/test/side-by-side-printer-tests.js b/test/side-by-side-printer-tests.js
index 76625f8e..771daaa5 100644
--- a/test/side-by-side-printer-tests.js
+++ b/test/side-by-side-printer-tests.js
@@ -14,7 +14,7 @@ describe('SideBySidePrinter', function() {
         '            File without changes\n' +
         '        &lt;/div&gt;\n' +
         '    &lt;/td&gt;\n' +
-        '&lt;/tr&gt;\n';
+        '&lt;/tr&gt;';

       assert.equal(expectedRight, fileHtml.right);
       assert.equal(expectedLeft, fileHtml.left);
@@ -324,7 +324,6 @@ describe('SideBySidePrinter', function() {
         '        &lt;/div&gt;\n' +
         '    &lt;/td&gt;\n' +
         '&lt;/tr&gt;\n' +
-        '\n' +
         '                    &lt;/tbody&gt;\n' +
         '                &lt;/table&gt;\n' +
         '            &lt;/div&gt;\n' +

From f3cadb96677d0eb82fc2752dc3ffbf35ca9b5bdb Mon Sep 17 00:00:00 2001
From: Rodrigo Fernandes &lt;rtfrodrigo@gmail.com&gt;
Date: Sat, 15 Oct 2016 13:21:22 +0100
Subject: [PATCH 2/2] Allow uncompiled templates

---
 README.md                 |  3 +++
 src/hoganjs-utils.js      |  7 +++++++
 test/hogan-cache-tests.js | 24 +++++++++++++++++++++++-
 3 files changed, 33 insertions(+), 1 deletion(-)

diff --git a/README.md b/README.md
index 132c8a28..46909f25 100644
--- a/README.md
+++ b/README.md
@@ -98,6 +98,9 @@ The HTML output accepts a Javascript object with configuration. Possible options
   - `synchronisedScroll`: scroll both panes in side-by-side mode: `true` or `false`, default is `false`
   - `matchWordsThreshold`: similarity threshold for word matching, default is 0.25
   - `matchingMaxComparisons`: perform at most this much comparisons for line matching a block of changes, default is `2500`
+  - `templates`: object with previously compiled templates to replace parts of the html
+  - `rawTemplates`: object with raw not compiled templates to replace parts of the html
+  &gt; For more information regarding the possible templates look into [src/templates](https://github.com/rtfpessoa/diff2html/tree/master/src/templates)

 ## Diff2HtmlUI Helper

diff --git a/src/hoganjs-utils.js b/src/hoganjs-utils.js
index 0dda08d7..b2e9c275 100644
--- a/src/hoganjs-utils.js
+++ b/src/hoganjs-utils.js
@@ -17,6 +17,13 @@
   function HoganJsUtils(configuration) {
     this.config = configuration || {};
     extraTemplates = this.config.templates || {};
+
+    var rawTemplates = this.config.rawTemplates || {};
+    for (var templateName in rawTemplates) {
+      if (rawTemplates.hasOwnProperty(templateName)) {
+        if (!extraTemplates[templateName]) extraTemplates[templateName] = this.compile(rawTemplates[templateName]);
+      }
+    }
   }

   HoganJsUtils.prototype.render = function(namespace, view, params) {
diff --git a/test/hogan-cache-tests.js b/test/hogan-cache-tests.js
index 3bb754ac..a34839c0 100644
--- a/test/hogan-cache-tests.js
+++ b/test/hogan-cache-tests.js
@@ -36,7 +36,7 @@ describe('HoganJsUtils', function() {
       assert.equal(null, result);
     });

-    it('should allow templates to be overridden', function() {
+    it('should allow templates to be overridden with compiled templates', function() {
       var emptyDiffTemplate = HoganJsUtils.compile('&lt;p&gt;&lt;/p&gt;');

       var config = {templates: {'generic-empty-diff': emptyDiffTemplate}};
@@ -44,5 +44,27 @@ describe('HoganJsUtils', function() {
       var result = hoganUtils.render('generic', 'empty-diff', {myName: 'Rodrigo Fernandes'});
       assert.equal('&lt;p&gt;Rodrigo Fernandes&lt;/p&gt;', result);
     });
+
+    it('should allow templates to be overridden with uncompiled templates', function() {
+      var emptyDiffTemplate = '&lt;p&gt;&lt;/p&gt;';
+
+      var config = {rawTemplates: {'generic-empty-diff': emptyDiffTemplate}};
+      var hoganUtils = new (require('../src/hoganjs-utils.js').HoganJsUtils)(config);
+      var result = hoganUtils.render('generic', 'empty-diff', {myName: 'Rodrigo Fernandes'});
+      assert.equal('&lt;p&gt;Rodrigo Fernandes&lt;/p&gt;', result);
+    });
+
+    it('should allow templates to be overridden giving priority to compiled templates', function() {
+      var emptyDiffTemplate = HoganJsUtils.compile('&lt;p&gt;&lt;/p&gt;');
+      var emptyDiffTemplateUncompiled = '&lt;p&gt;Not used!&lt;/p&gt;';
+
+      var config = {
+        templates: {'generic-empty-diff': emptyDiffTemplate},
+        rawTemplates: {'generic-empty-diff': emptyDiffTemplateUncompiled}
+      };
+      var hoganUtils = new (require('../src/hoganjs-utils.js').HoganJsUtils)(config);
+      var result = hoganUtils.render('generic', 'empty-diff', {myName: 'Rodrigo Fernandes'});
+      assert.equal('&lt;p&gt;Rodrigo Fernandes&lt;/p&gt;', result);
+    });
   });
 });
</code></pre>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="code"/><summary type="html"><![CDATA[this is how you can display code diffs]]></summary></entry><entry><title type="html">a post with advanced image components</title><link href="https://anrodon.github.io/blog/2024/advanced-images/" rel="alternate" type="text/html" title="a post with advanced image components"/><published>2024-01-27T11:46:00+00:00</published><updated>2024-01-27T11:46:00+00:00</updated><id>https://anrodon.github.io/blog/2024/advanced-images</id><content type="html" xml:base="https://anrodon.github.io/blog/2024/advanced-images/"><![CDATA[<p>This is an example post with advanced image components.</p> <h2 id="image-slider">Image Slider</h2> <p>This is a simple image slider. It uses the <a href="https://swiperjs.com/">Swiper</a> library. Check the <a href="https://swiperjs.com/demos">examples page</a> for more information of what you can achieve with it.</p> <swiper-container keyboard="true" navigation="true" pagination="true" pagination-clickable="true" pagination-dynamic-bullets="true" rewind="true"> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/9-480.webp 480w,/assets/img/9-800.webp 800w,/assets/img/9-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/9.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/7-480.webp 480w,/assets/img/7-800.webp 800w,/assets/img/7-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/7.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/8-480.webp 480w,/assets/img/8-800.webp 800w,/assets/img/8-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/8.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/10-480.webp 480w,/assets/img/10-800.webp 800w,/assets/img/10-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/10.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/12-480.webp 480w,/assets/img/12-800.webp 800w,/assets/img/12-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/12.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> </swiper-container> <h2 id="image-comparison-slider">Image Comparison Slider</h2> <p>This is a simple image comparison slider. It uses the <a href="https://img-comparison-slider.sneas.io/">img-comparison-slider</a> library. Check the <a href="https://img-comparison-slider.sneas.io/examples.html">examples page</a> for more information of what you can achieve with it.</p> <img-comparison-slider> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/assets/img/prof_pic-480.webp 480w,/assets/img/prof_pic-800.webp 800w,/assets/img/prof_pic-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/prof_pic.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/assets/img/prof_pic_color-480.webp 480w,/assets/img/prof_pic_color-800.webp 800w,/assets/img/prof_pic_color-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/prof_pic_color.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="images"/><summary type="html"><![CDATA[this is what advanced image components could look like]]></summary></entry></feed>